# 📡 TCP 커넥션
--- 

## 💻 TCP 커넥션이란
 👉 두 대의 호스트 컴퓨터가 신뢰성 있는 HTTP 메세지 교환을 위해 TCP 프로토콜로 맺은 연결

- **IP**: 데이터 조각을 최대한 빨리 목적지로 보내는 것이 목표
- **TCP**: IP보다 느리지만 꼼꼼한 방식. 조각의 순서나 누락을 고려
→ 두 방식을 합쳐 인터넷 데이터 통신을 하는 것 : **TCP/IP**
<br>

## 💻 TCP 커넥션 과정
1. 브라우저가 호스트명을 추출한다. (ex_www.youtube.com)
2. 브라우저가 이 호스트명에 대한 **IP 주소**를 찾는다. (ex_208.65.153.238)
3. 브라우저가 **포트 번호**를 얻는다. (ex_80)
4. 브라우저가 위 IP주소의 80포트로 TCP 커넥션을 생성한다.
5. 브라우저가 서버로 HTTP 요청 메시지를 보낸다.
6. 브라우저가 서버에서 온 HTTP 응답 메시지를 읽는다.
7. 브라우저가 커넥션을 끊는다.

<br>

## 🎇 TCP 성능의 중요성
![](https://velog.velcdn.com/images/mooongs/post/3f436967-1962-4e59-97c8-15eac2947789/image.png)

👉  HTTP는 TCP 위에 있는 계층이므로 트랜잭션에 있어 TCP의 영향을 받는다.

👉  참고
**HTTP는** 일반 사용자와 인터넷과의 전송 프로토콜 규약
**TCP/IP**는 서로 다른 컴퓨터간의 전송을 할 수 있는 프로토콜 규약

<br>

## 📉 HTTP 트랙잭션 지연 
- 원인: TCP 네트워크 지연 (커넥션 설정 시간, 서버의 메시지 처리 소요 시간)
- 기타 이유 : 하드웨어의 성능, 네트워크와 서버의 전송 속도, 요청/응답 메시지의 크기, 클라이언트와 서버 간의 거리
- 순차적인 트랜잭션 처리 : 물리적인 지연 / 심리적인 지연
<br>

## 💡 HTTP 커넥션의 성능 향상 기법
### 1. 병렬 커넥션
- 여러 개의 커넥션을 맺음으로써 여러 트랜잭션을 병렬로 처리 가능
- 👍 **장점 1** : 단일 커넥션의 대역폭 제한 이슈 해결
	- ❓ **대역폭** : 데이터가 지나가는 공간으로, 대역폭이 넓을수록 빠른 데이터 처리가 가능
 	- BUT, 각 커넥션을 맺고 끊을 때마다 시간과 대역폭 소요
- 👍 **장점 2** : 커넥션 지연이 겹쳐지면서 총 지연시간이 단축된다.
	- BUT, 새로운 커넥션의 경우 TCP 느린시작 때문에 성능이 느려진다
- 일반적으로 더 빠르긴 하나 항상 그렇지는 않다 (빨라 보이는 것일수도)
- 👎 **단점**
	- 커넥션을 생성하면서 부하가 생긴다
	- 다수의 커넥션은 메모리를 많이 소요하고 자체적인 성능 이슈가 있음
	- 서버의 성능 저하 (대부분 4개까지만 연결)
<br>

### 2. 지속 커넥션
- 서버에 이미 맺어져 있는 커넥션을 재사용하는 방법
- 👍 **장점 1** : 커넥션 연결 과정에서 시간을 절약할 수 있다
- 👍 **장점 2**: **튜닝된 커넥션**을 유지할 수 있다 → 빠른 데이터 전송 가능
	- ❓ **튜닝된 커넥션** : 처음에는 커넥션의 최대 속도를 제한하고 데이터가 성공적으로 전송됨에 따라서 속도 제한을 높여 나간다 (=TCP 느린 시작, 자체적 튜닝)
    
- 👎 **단점**: 연결된 상태의 커넥션이 쌓일 수 있다 → 클라이언트와 서버의 리소스 부하
- 병렬과 지속 커넥션을 함께 사용하는 것이 이상적
<br>

#### 2-1. HTTP/1.0+의 Keep-Alive 커넥션
- 커넥션 유지를 위해 요청 메시지 헤더에 `Connection:Keep-Alive` 포함
- 멍청한(dumb) 프락시의 문제점
	- connection 헤더를 무조건 전달
    - 이해하지 못한 `connection:keep-alive` 헤더를 서버에 그대로 전달 → 해당 커넥션으로 들어오는 요청을 모두 무시하고 커넥션이 끊어질 것이라 가정 → 클라이언트의 두 번째 요청은 전달되지 못함
    - 해결 방안 : `Proxy-connection` 확장 헤더
<br>

#### 2-2. HTTP/1.1의 지속 커넥션
- Keep-Alive를 더 개선한 커넥션
- 지속 커넥션이 기본으로 활성화 (끊기 위해 `Connection:close` 헤더 명시)
- **파이프라인 커넥션**
	- 하나의 커넥션에서 한번에 여러 요청을 순차적으로 보내고 그 순서에 맞춰 응답을 받는 방식
	- 네트워크상의 왕복 시간이 단축된다
